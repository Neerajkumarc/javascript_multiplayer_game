<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .player {
            width: 50px;
            height: 50px;
        }
    </style>
</head>

<body>
    <canvas id="canvas">

    </canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script>

        const canvas = document.getElementById("canvas")
        canvas.width = window.innerWidth
        canvas.height = window.innerHeight
        const ctx = canvas.getContext("2d")
        class Player {
            constructor({ x, y, width, height , color}) {
                this.x = x
                this.y = y
                this.width = width
                this.height = height
                this.color = color
            }
            draw() {
                ctx.fillStyle = this.color
                ctx.fillRect(this.x, this.y, this.width, this.height)
            }
        }
        // ctx.fillStyle = "red"
        // ctx.fillRect(50, 50, 50, 50)



    </script>
    <script>
        const boardEl = document.getElementById("board")
        const playersMap = {}
        const socket = io();
        socket.on("players", (players) => {
            for (const id in players) {
                const player = players[id]
                if (!playersMap[id]) {
                    playersMap[id] = new Player({ x: player.x, y: player.y, width: player.width, height: player.height, color:player.color})
                }else{
                    playersMap[id].x = players[id].x
                    playersMap[id].y = players[id].y
                }
            }

            for (const id in playersMap) {
                if (!players[id]) {
                    delete playersMap[id]
                }
            }
            // console.log(playersMap);
        })


        function animate() {
            requestAnimationFrame(animate)
            ctx.clearRect(0, 0, canvas.width, canvas.height)
            for (const id in playersMap) {
                const player = playersMap[id]
                player.draw()
            }

        }
        animate()

        addEventListener("keydown",(e)=>{
            switch(e.key){
                case "w":
                    // playersMap[socket.id].y -= 30
                    socket.emit("keydown", "w")
                    break;
                case "a":
                    // playersMap[socket.id].x -= 30
                    socket.emit("keydown", "a")
                    break;
                case "s":
                    // playersMap[socket.id].y += 30
                    socket.emit("keydown", "s")
                    break;
                case "d":
                    // playersMap[socket.id].x += 30
                    socket.emit("keydown", "d")
                    break;
            }
        })
    </script>
</body>

</html>